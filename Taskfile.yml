version: "3"

tasks:
  default:
    aliases:
      - list
      - l
    desc: List all tasks if none is specified
    cmd: task --list-all

  build-osx:
    desc: Perform osx build
    aliases:
      - osx
    platforms: [darwin]
    cmd: sudo darwin-rebuild switch --flake ./
  build-linux:
    desc: Perform linux based build
    aliases:
      - linux
    platforms: [linux]
    cmd: sudo nixos-rebuild switch --flake ./
  switch:
    desc: Runs the appropriate switch command for the platform
    aliases:
      - build
      - b
      - s
    cmds:
      - cmd: task build-osx
        platforms: [darwin]
      - cmd: task build-linux
        platforms: [linux]
  test:
    desc: Run nix flake check
    aliases:
      - t
    cmd: nix flake check

  fmt:
    desc: Run formatter on all nix files.
    aliases:
      - f
    cmds:
      - alejandra *.nix

  secrets-get:
    desc: "Get secrets file using 1Password cli"
    cmd: echo "Not Yet Implemented"

  secrets-set:
    desc: "Set secrets file using 1Password cli"
    cmds:
      - op --version
      - echo "Not Yet Implemented"

  init:
    desc: Initial setup commands
    cmds:
      - sudo nix run nix-darwin/master#darwin-rebuild -- switch --flake ./
